{
  "info": {
 "name": "DemoGeoServer Auth API",
    "_postman_id": "demo-geo-auth-collection",
    "description": "Authentication API endpoints for DemoGeoServer - Login with Email",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5148/api",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
"type": "string"
    },
    {
    "key": "refreshToken",
      "value": "",
    "type": "string"
    }
  ],
  "item": [
    {
"name": "Auth",
    "item": [
        {
        "name": "Register User",
 "request": {
        "method": "POST",
         "header": [
              {
        "key": "Content-Type",
  "value": "application/json"
      }
],
            "url": {
          "raw": "{{baseUrl}}/auth/register",
     "host": ["{{baseUrl}}"],
  "path": ["auth", "register"]
            },
     "body": {
   "mode": "raw",
      "raw": "{\n  \"username\": \"testuser\",\n  \"email\": \"testuser@demo.com\",\n  \"password\": \"password123\",\n  \"role\": \"User\"\n}"
            }
          },
          "response": []
    },
  {
          "name": "Register Admin",
          "request": {
            "method": "POST",
    "header": [
              {
   "key": "Content-Type",
    "value": "application/json"
  }
            ],
            "url": {
    "raw": "{{baseUrl}}/auth/register",
        "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "body": {
 "mode": "raw",
       "raw": "{\n  \"username\": \"admin\",\n  \"email\": \"admin@demo.com\",\n  \"password\": \"password123\",\n  \"role\": \"Admin\"\n}"
            }
          },
          "response": []
        },
        {
      "name": "Login with Email (Admin)",
      "event": [
            {
      "listen": "test",
   "script": {
   "exec": [
             "if (pm.response.code === 200) {",
              "    const jsonData = pm.response.json();",
      "    if (jsonData.success) {",
          " pm.collectionVariables.set('accessToken', jsonData.token);",
           "  pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
      "        console.log('Tokens saved to collection variables');",
  "    }",
 "}"
         ]
   }
            }
          ],
   "request": {
         "method": "POST",
            "header": [
              {
         "key": "Content-Type",
          "value": "application/json"
              }
            ],
            "url": {
    "raw": "{{baseUrl}}/auth/login",
  "host": ["{{baseUrl}}"],
"path": ["auth", "login"]
       },
       "body": {
     "mode": "raw",
              "raw": "{\n  \"email\": \"admin@demo.com\",\n  \"password\": \"password123\"\n}"
   }
        },
"response": []
  },
      {
          "name": "Login with Email (User)",
  "event": [
            {
      "listen": "test",
              "script": {
           "exec": [
       "if (pm.response.code === 200) {",
      "    const jsonData = pm.response.json();",
                  "    if (jsonData.success) {",
          "        pm.collectionVariables.set('accessToken', jsonData.token);",
"        pm.collectionVariables.set('refreshToken', jsonData.refreshToken);",
"    }",
      "}"
      ]
              }
       }
          ],
  "request": {
         "method": "POST",
       "header": [
              {
   "key": "Content-Type",
           "value": "application/json"
              }
            ],
       "url": {
     "raw": "{{baseUrl}}/auth/login",
  "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "body": {
     "mode": "raw",
      "raw": "{\n  \"email\": \"testuser@demo.com\",\n  \"password\": \"password123\"\n}"
}
          },
          "response": []
        },
        {
 "name": "Login - Invalid Email Format",
       "request": {
      "method": "POST",
       "header": [
       {
                "key": "Content-Type",
      "value": "application/json"
          }
            ],
    "url": {
  "raw": "{{baseUrl}}/auth/login",
            "host": ["{{baseUrl}}"],
  "path": ["auth", "login"]
            },
         "body": {
    "mode": "raw",
            "raw": "{\n  \"email\": \"not-an-email\",\n  \"password\": \"password123\"\n}"
            }
   },
          "response": []
   },
        {
          "name": "Login - Wrong Password",
          "request": {
            "method": "POST",
            "header": [
    {
   "key": "Content-Type",
       "value": "application/json"
          }
 ],
  "url": {
         "raw": "{{baseUrl}}/auth/login",
 "host": ["{{baseUrl}}"],
         "path": ["auth", "login"]
},
          "body": {
"mode": "raw",
            "raw": "{\n  \"email\": \"admin@demo.com\",\n  \"password\": \"wrongpassword\"\n}"
  }
          },
    "response": []
        },
     {
          "name": "Login - Non-existent Email",
       "request": {
            "method": "POST",
            "header": [
      {
          "key": "Content-Type",
  "value": "application/json"
       }
            ],
   "url": {
     "raw": "{{baseUrl}}/auth/login",
   "host": ["{{baseUrl}}"],
      "path": ["auth", "login"]
   },
            "body": {
            "mode": "raw",
              "raw": "{\n  \"email\": \"notexist@demo.com\",\n  \"password\": \"password123\"\n}"
         }
      },
      "response": []
  },
        {
    "name": "Refresh Token",
          "event": [
            {
   "listen": "test",
    "script": {
          "exec": [
       "if (pm.response.code === 200) {",
           "const jsonData = pm.response.json();",
    "    if (jsonData.success) {",
             "        pm.collectionVariables.set('accessToken', jsonData.token);",
          "        console.log('Access token refreshed');",
     "    }",
    "}"
           ]
   }
    }
    ],
   "request": {
        "method": "POST",
        "header": [
              {
          "key": "Content-Type",
     "value": "application/json"
              }
          ],
 "url": {
              "raw": "{{baseUrl}}/auth/refresh",
   "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
         "body": {
     "mode": "raw",
         "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
  }
          },
          "response": []
        },
        {
          "name": "Logout",
        "request": {
            "method": "POST",
            "header": [
        {
          "key": "Content-Type",
     "value": "application/json"
      }
      ],
            "url": {
   "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
    "path": ["auth", "logout"]
            },
            "body": {
        "mode": "raw",
  "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            }
},
    "response": []
        }
      ]
    },
  {
      "name": "Test Endpoints",
      "item": [
        {
          "name": "Public Endpoint",
   "request": {
            "method": "GET",
            "header": [],
            "url": {
       "raw": "{{baseUrl}}/test/public",
  "host": ["{{baseUrl}}"],
"path": ["test", "public"]
            }
    },
          "response": []
        },
      {
   "name": "Protected Endpoint",
          "request": {
     "auth": {
  "type": "bearer",
              "bearer": [
       {
   "key": "token",
          "value": "{{accessToken}}",
 "type": "string"
          }
              ]
    },
 "method": "GET",
            "header": [],
      "url": {
           "raw": "{{baseUrl}}/test/protected",
    "host": ["{{baseUrl}}"],
              "path": ["test", "protected"]
            }
   },
          "response": []
        },
        {
  "name": "Check Role (Debug)",
     "request": {
            "auth": {
   "type": "bearer",
            "bearer": [
        {
   "key": "token",
      "value": "{{accessToken}}",
           "type": "string"
           }
              ]
            },
          "method": "GET",
      "header": [],
            "url": {
   "raw": "{{baseUrl}}/test/check-role",
      "host": ["{{baseUrl}}"],
            "path": ["test", "check-role"]
            }
          },
          "response": []
        },
  {
          "name": "Admin Endpoint",
  "request": {
    "auth": {
     "type": "bearer",
           "bearer": [
                {
           "key": "token",
     "value": "{{accessToken}}",
     "type": "string"
    }
         ]
            },
 "method": "GET",
      "header": [],
         "url": {
          "raw": "{{baseUrl}}/test/admin",
              "host": ["{{baseUrl}}"],
              "path": ["test", "admin"]
            }
        },
          "response": []
        }
      ]
    }
  ]
}
